sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","com/apptech/realestate/controller/AppUI5"],function(e,t,s,o,i,d){"use strict";return e.extend("com.apptech.realestate.controller.BusinessRole",{onRoutePatternMatched:function(e){this.prepareTable(false)},onInit:function(){var e=this.getOwnerComponent().getRouter().getRoute("BusinessRole");e.attachPatternMatched(this.onRoutePatternMatched,this);this.bIsAdd="0";this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());this.aCols=[];this.columnData=[];this.oEditRecord={};this.iRecordCount=0;this.oIconTab=this.getView().byId("tab1");this.oIconTab2=this.getView().byId("tab2");this.recordCode="";this.oMdlAllRecord=new t;this.oMdlEditRecord=new t("model/BusinessRole.json");this.getView().setModel(this.oMdlEditRecord,"oMdlEditRecord");this.oMdlRoleStatus=new t("model/BusinessRoleStatus.json");this.getView().setModel(this.oMdlRoleStatus,"oMdlRoleStatus");this.prepareTable(true)},prepareTable:function(e){$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=APP_RE&procName=SPAPP_RE_GETBUSINESSROLE&keyCode=&queryType=GetAllBusinessRole",type:"GET",xhrFields:{withCredentials:true},error:function(e,t,o){s.show(o)},success:function(e){},context:this}).done(function(t){if(t){this.aCols=Object.keys(t[0]);var s;this.iRecordCount=t.length;this.oIconTab.setCount(this.iRecordCount);if(e){for(s=0;s<this.aCols.length;s++){this.columnData.push({columnName:this.aCols[s]})}}this.oMdlAllRecord.setData({rows:t,columns:this.columnData});if(e){this.oTable=this.getView().byId("tblBusinessRole");this.oTable.setModel(this.oMdlAllRecord);this.oTable.bindColumns("/columns",function(e,t){var s=t.getObject().columnName;return new sap.ui.table.Column({label:s,template:new sap.m.Text({text:"{"+s+"}"})})});this.oTable.bindRows("/rows");this.oTable.setSelectionMode("Single");this.oTable.setSelectionBehavior("Row");this.renameColumns()}}})},renameColumns:function(){this.oTable.getColumns()[0].setVisible(false);this.oTable.getColumns()[1].setLabel("Description");this.oTable.getColumns()[1].setFilterProperty("Desc");this.oTable.getColumns()[2].setLabel("Other Description");this.oTable.getColumns()[2].setFilterProperty("OtherDesc");this.oTable.getColumns()[3].setLabel("Is Active");this.oTable.getColumns()[4].setLabel("Remarks");this.oTable.getColumns()[5].setLabel("Date Created")},onEdit:function(e){var t=this.oTable.getSelectedIndex();var o="GetSpecificBusinessRole";var i="";if(t!==-1){var d=this.oTable.getBinding().getModel().getData().rows[this.oTable.getBinding().aIndices[t]];i=d.Code;$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=APP_RE&procName=SPAPP_RE_GETBUSINESSROLE&keyCode="+i+"&queryType="+o,type:"GET",xhrFields:{withCredentials:true},error:function(e,t,o){s.show(o)},success:function(e){},context:this}).done(function(e){if(e.length<=0){return}var t=JSON.stringify(e).replace("[","").replace("]","");this.oMdlEditRecord.setJSON('{"EditRecord" : '+t+"}");this.getView().setModel(this.oMdlEditRecord,"oMdlEditRecord");this.getView().byId("idIconTabBarInlineMode").getItems()[1].setText("Record Code : "+this.oMdlEditRecord.getData().EditRecord.Desc+" [EDIT]")})}this.recordCode=i;var r=this.getView().byId("idIconTabBarInlineMode");r.setSelectedKey("tab2");this.bIsAdd="E"},onAdd:function(e){this.oMdlEditRecord.getData().EditRecord.Code="";this.oMdlEditRecord.getData().EditRecord.Desc="";this.oMdlEditRecord.getData().EditRecord.OtherDesc="";this.oMdlEditRecord.getData().EditRecord.IsActive="Y";this.oMdlEditRecord.getData().EditRecord.Remarks="";this.oMdlEditRecord.refresh();this.getView().byId("idIconTabBarInlineMode").getItems()[1].setText("RECORD [ADD]");var t=this.getView().byId("idIconTabBarInlineMode");t.setSelectedKey("tab2");this.bIsAdd="A"},onSave:function(e){if(this.bIsAdd==="0"){return}if(this.bIsAdd==="A"){var t=d.generateUDTCode();var o="";$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=SPAPP_RE_GETBUSINESSROLE&keyCode=&queryType=GetNewCode",type:"GET",async:false,xhrFields:{withCredentials:true},error:function(e,t,s){jQuery.sap.log.error("This should never have happened!")},success:function(e){o=e[0].Code},context:this}).done(function(e){if(e){o=e[0].Code}});var i={};i.R_ROLE=[];var r={};r.O="I";r.Code=t;r.Desc=this.oMdlEditRecord.getData().EditRecord.Desc;r.OtherDesc=this.oMdlEditRecord.getData().EditRecord.OtherDesc;r.IsActive=this.oMdlEditRecord.getData().EditRecord.IsActive;r.Remarks=this.oMdlEditRecord.getData().EditRecord.Remarks;i.R_ROLE.push(r);var l=d.postData(i);if(l===0){s.show("Saved Successfully "+o)}else{s.show("Error")}}else{i={};i.R_ROLE=[];r={};r.O="U";r.Code=this.oMdlEditRecord.getData().EditRecord.Code;r.Desc=this.oMdlEditRecord.getData().EditRecord.Desc;r.OtherDesc=this.oMdlEditRecord.getData().EditRecord.OtherDesc;r.IsActive=this.oMdlEditRecord.getData().EditRecord.IsActive;r.Remarks=this.oMdlEditRecord.getData().EditRecord.Remarks;i.R_ROLE.push(r);l=d.postData(i);if(l===0){s.show("Successfully Updated "+this.oMdlEditRecord.getData().EditRecord.Desc)}else{s.show("Error")}}this.prepareTable(false)},filterGlobally:function(e){var t=e.getParameter("query");this._oGlobalFilter=null;if(t){this._oGlobalFilter=new o([new o("Desc",i.Contains,t),new o("OtherDesc",i.Contains,t)],false)}this._filter()},_filter:function(){var e=null;if(this._oGlobalFilter){e=this._oGlobalFilter}this.byId("tblBusinessRole").getBinding().filter(e,"Application")},clearAllFilters:function(e){var t=this.getView().byId("tblBusinessRole");this._oGlobalFilter=null;this._filter();var s=t.getColumns();for(var o=0;o<s.length;o++){t.filter(s[o],null)}},onChangeRoleStatus:function(e){var t=e.getSource().getProperty("selectedKey");this.oMdlEditRecord.getData().EditRecord.IsActive=t}})});