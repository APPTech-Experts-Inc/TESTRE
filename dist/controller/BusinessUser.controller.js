sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","com/apptech/realestate/controller/AppUI5"],function(e,t,o,s,i,d){"use strict";return e.extend("com.apptech.realestate.controller.BusinessUser",{onRoutePatternMatched:function(e){this.prepareTable(false)},onInit:function(){var e=this.getOwnerComponent().getRouter().getRoute("BusinessUser");e.attachPatternMatched(this.onRoutePatternMatched,this);this.bIsAdd="0";this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());this.aCols=[];this.columnData=[];this.oEditRecord={};this.iRecordCount=0;this.oIconTab=this.getView().byId("tab1");this.oIconTab2=this.getView().byId("tab2");this.recordCode="";this.oMdlAllRecord=new t;this.oMdlEditRecord=new t("model/BusinessUser.json");this.getView().setModel(this.oMdlEditRecord,"oMdlEditRecord");this.oMdlRole=new t;$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=APP_RE&procName=SPAPP_RE_GETBUSINESSUSER&keyCode=&queryType=GetUserRole",type:"GET",xhrFields:{withCredentials:true},error:function(e,t,s){o.show(s)},success:function(e){},context:this}).done(function(e){if(e){this.oMdlRole.setJSON('{"allbusinessrole" : '+JSON.stringify(e)+"}");this.getView().setModel(this.oMdlRole,"oMdlRole")}});this.prepareTable(true)},prepareTable:function(e){$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=APP_RE&procName=SPAPP_RE_GETBUSINESSUSER&keyCode=&queryType=GetAllBusinessUser",type:"GET",xhrFields:{withCredentials:true},error:function(e,t,s){o.show(s)},success:function(e){},context:this}).done(function(t){if(t){this.aCols=Object.keys(t[0]);var o;this.iRecordCount=t.length;this.oIconTab.setCount(this.iRecordCount);if(e){for(o=0;o<this.aCols.length;o++){this.columnData.push({columnName:this.aCols[o]})}}this.oMdlAllRecord.setData({rows:t,columns:this.columnData});if(e){this.oTable=this.getView().byId("tblBusinessUser");this.oTable.setModel(this.oMdlAllRecord);this.oTable.bindColumns("/columns",function(e,t){var o=t.getObject().columnName;return new sap.ui.table.Column({label:o,template:new sap.m.Text({text:"{"+o+"}"})})});this.oTable.bindRows("/rows");this.oTable.setSelectionMode("Single");this.oTable.setSelectionBehavior("Row");this.renameColumns()}}})},renameColumns:function(){this.oTable.getColumns()[0].setVisible(false);this.oTable.getColumns()[1].setLabel("Username");this.oTable.getColumns()[1].setFilterProperty("LoginCode");this.oTable.getColumns()[2].setVisible(false);this.oTable.getColumns()[3].setLabel("Role");this.oTable.getColumns()[4].setVisible(false);this.oTable.getColumns()[5].setVisible(false);this.oTable.getColumns()[6].setLabel("Date Created")},onEdit:function(e){var t=this.oTable.getSelectedIndex();var s="GetSpecificBusinessUser";var i="";if(t!==-1){var d=this.oTable.getBinding().getModel().getData().rows[this.oTable.getBinding().aIndices[t]];i=d.Code;$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=APP_RE&procName=SPAPP_RE_GETBUSINESSUSER&keyCode="+i+"&queryType="+s,type:"GET",xhrFields:{withCredentials:true},error:function(e,t,s){o.show(s)},success:function(e){},context:this}).done(function(e){if(e.length<=0){return}var t=JSON.stringify(e).replace("[","").replace("]","");this.oMdlEditRecord.setJSON('{"EditRecord" : '+t+"}");this.getView().setModel(this.oMdlEditRecord,"oMdlEditRecord");this.getView().byId("idIconTabBarInlineMode").getItems()[1].setText("Record Code : "+this.oMdlEditRecord.getData().EditRecord.LoginCode+" [EDIT]")})}this.recordCode=i;var r=this.getView().byId("idIconTabBarInlineMode");r.setSelectedKey("tab2");this.bIsAdd="E"},onAdd:function(e){this.oMdlEditRecord.getData().EditRecord.Code="";this.oMdlEditRecord.getData().EditRecord.LoginCode="";this.oMdlEditRecord.getData().EditRecord.Password="";this.oMdlEditRecord.getData().EditRecord.RoleCode="";this.oMdlEditRecord.getData().EditRecord.EmailPassRecovery="";this.oMdlEditRecord.refresh();this.getView().byId("idIconTabBarInlineMode").getItems()[1].setText("RECORD [ADD]");var t=this.getView().byId("idIconTabBarInlineMode");t.setSelectedKey("tab2");this.bIsAdd="A"},onSave:function(e){if(this.bIsAdd==="0"){return}if(this.bIsAdd==="A"){var t=d.generateUDTCode();var s="";$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=SPAPP_RE_GETBUSINESSUSER&keyCode=&queryType=GetNewCode",type:"GET",async:false,xhrFields:{withCredentials:true},error:function(e,t,o){jQuery.sap.log.error("This should never have happened!")},success:function(e){s=e[0].Code},context:this}).done(function(e){if(e){s=e[0].Code}});var i={};i.M_USER=[];var r={};r.O="I";r.Code=t;r.LoginCode=this.oMdlEditRecord.getData().EditRecord.LoginCode;r.Password=this.oMdlEditRecord.getData().EditRecord.Password;r.RoleCode=this.oMdlEditRecord.getData().EditRecord.RoleCode;r.EmailPassRecovery=this.oMdlEditRecord.getData().EditRecord.EmailPassRecovery;i.M_USER.push(r);var l=d.postData(i);if(l===0){o.show("Saved Successfully "+r.LoginCode)}else{o.show("Error")}}else{i={};i.M_USER=[];r={};r.O="U";r.Code=this.oMdlEditRecord.getData().EditRecord.Code;r.LoginCode=this.oMdlEditRecord.getData().EditRecord.LoginCode;r.Password=this.oMdlEditRecord.getData().EditRecord.Password;r.RoleCode=this.oMdlEditRecord.getData().EditRecord.RoleCode;r.EmailPassRecovery=this.oMdlEditRecord.getData().EditRecord.EmailPassRecovery;i.M_USER.push(r);l=d.postData(i);if(l===0){o.show("Successfully Updated "+this.oMdlEditRecord.getData().EditRecord.LoginCode)}else{o.show("Error")}}this.prepareTable(false)},filterGlobally:function(e){var t=e.getParameter("query");this._oGlobalFilter=null;if(t){this._oGlobalFilter=new s([new s("LoginCode",i.Contains,t)],false)}this._filter()},_filter:function(){var e=null;if(this._oGlobalFilter){e=this._oGlobalFilter}this.byId("tblBusinessUser").getBinding().filter(e,"Application")},clearAllFilters:function(e){var t=this.getView().byId("tblBusinessUser");this._oGlobalFilter=null;this._filter();var o=t.getColumns();for(var s=0;s<o.length;s++){t.filter(o[s],null)}},onChangeRole:function(e){var t=e.getSource().getProperty("selectedKey");this.oMdlEditRecord.getData().EditRecord.RoleCode=t}})});