sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","com/apptech/realestate/controller/AppUI5"],function(t,e,d,o,i,r){"use strict";return t.extend("com.apptech.realestate.controller.BusinessPartner",{onRoutePatternMatched:function(t){this.prepareTable(false);var e=3},onInit:function(){var t=this.getOwnerComponent().getRouter().getRoute("BusinessPartner");t.attachPatternMatched(this.onRoutePatternMatched,this);this.bIsAdd=true;this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());this.aCols=[];this.columnData=[];this.oEditRecord={};this.iRecordCount=0;this.oIconTab=this.getView().byId("tab1");this.oIconTab2=this.getView().byId("tab2");this.recordCode="";this.oMdlAllRecord=new e;this.oMdlEditRecord=new e("model/BusinessPartner.json");this.getView().setModel(this.oMdlEditRecord,"oMdlEditRecord");this.oMdlCivilStats=new e("model/AllCivilStats.json");this.getView().setModel(this.oMdlCivilStats,"oMdlCivilStats");this.oMdlDocumentsTab=new e("model/BusinessPartnerDocs.json");this.getView().setModel(this.oMdlDocumentsTab,"oMdlDocumentsTab");this.oMdlBPStatus=new e;$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=APP_RE&procName=SPAPP_RE_CUSTOMER&queryType=GETBPSTATUS&colValue=&colValue2=",type:"GET",xhrFields:{withCredentials:true},error:function(t,e,o){d.show(o)},success:function(t){},context:this}).done(function(t){if(t){this.oMdlBPStatus.setJSON('{"allbpstatus" : '+JSON.stringify(t)+"}");this.getView().setModel(this.oMdlBPStatus,"oMdlBPStatus")}});this.prepareTable(true)},prepareTable:function(t){$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=APP_RE&procName=SPAPP_RE_CUSTOMER&queryType=GETALLCUSTOMERS&colValue=&colValue2=",type:"GET",xhrFields:{withCredentials:true},error:function(t,e,o){d.show(o)},success:function(t){},context:this}).done(function(e){if(e){this.aCols=Object.keys(e[0]);var d;this.iRecordCount=e.length;this.oIconTab.setCount(this.iRecordCount);if(t){for(d=0;d<this.aCols.length;d++){this.columnData.push({columnName:this.aCols[d]})}}this.oMdlAllRecord.setData({rows:e,columns:this.columnData});if(t){this.oTable=this.getView().byId("tblBP");this.oTable.setModel(this.oMdlAllRecord);this.oTable.bindColumns("/columns",function(t,e){var d=e.getObject().columnName;return new sap.ui.table.Column({label:d,template:new sap.m.Text({text:"{"+d+"}"})})});this.oTable.bindRows("/rows");this.oTable.setSelectionMode("Single");this.oTable.setSelectionBehavior("Row");this.renameColumns()}}})},renameColumns:function(){this.oTable.getColumns()[0].setVisible(false);this.oTable.getColumns()[1].setLabel("Customer Code");this.oTable.getColumns()[1].setFilterProperty("CustomerCode");this.oTable.getColumns()[2].setLabel("Full Name");this.oTable.getColumns()[2].setFilterProperty("Name");this.oTable.getColumns()[3].setLabel("Mobile Number");this.oTable.getColumns()[4].setLabel("Email Address");this.oTable.getColumns()[5].setLabel("Created Date")},onEdit:function(t){var e=this.oTable.getSelectedIndex();var o="GET_ONEDIT";var i="";if(e!==-1){var r=this.oTable.getBinding().getModel().getData().rows[this.oTable.getBinding().aIndices[e]];i=r.Code;$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=APP_RE&procName=SPAPP_RE_CUSTOMER&tableName="+o+"&colValue="+i+"&colValue2="+"",type:"GET",xhrFields:{withCredentials:true},error:function(t,e,o){d.show(o)},success:function(t){},context:this}).done(function(t){if(t.length<=0){return}var e=JSON.stringify(t).replace("[","").replace("]","");this.oMdlEditRecord.setJSON('{"EditRecord" : '+e+"}");this.getView().setModel(this.oMdlEditRecord,"oMdlEditRecord");this.getView().byId("idIconTabBarInlineMode").getItems()[1].setText("Record Code : "+this.oMdlEditRecord.getData().EditRecord.CustomerCode+" [EDIT]")});o="GET_ONEDIT_CUSTOMERDOC";$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=APP_RE&procName=SPAPP_RE_CUSTOMER&queryType="+o+"&colValue="+i+"&colValue2="+"",type:"GET",xhrFields:{withCredentials:true},error:function(t,e,o){d.show(o)},success:function(t){},context:this}).done(function(t){if(t.length<=0){return}var e=JSON.stringify(t).replace("[","").replace("]","");this.oMdlDocumentsTab.setJSON('{"EditRecord" : '+e+"}");this.getView().setModel(this.oMdlDocumentsTab,"oMdlDocumentsTab")})}this.recordCode=i;var a=this.getView().byId("idIconTabBarInlineMode");a.setSelectedKey("tab2");this.bIsAdd=false},onAdd:function(t){this.oMdlEditRecord.getData().EditRecord.CustomerCode="";this.oMdlEditRecord.getData().EditRecord.StatusCode=1;this.oMdlEditRecord.getData().EditRecord.FirstName="";this.oMdlEditRecord.getData().EditRecord.MiddleName="";this.oMdlEditRecord.getData().EditRecord.LastName="";this.oMdlEditRecord.getData().EditRecord.Title="";this.oMdlEditRecord.getData().EditRecord.AcadTitle="";this.oMdlEditRecord.getData().EditRecord.BirthDate="01/01/1950";this.oMdlEditRecord.getData().EditRecord.BirthPlace="";this.oMdlEditRecord.getData().EditRecord.Gender="";this.oMdlEditRecord.getData().EditRecord.Nationality="";this.oMdlEditRecord.getData().EditRecord.CivilStat="";this.oMdlEditRecord.getData().EditRecord.SpouseName="";this.oMdlEditRecord.getData().EditRecord.TIN="";this.oMdlEditRecord.getData().EditRecord.Email="";this.oMdlEditRecord.getData().EditRecord.LandlineNo="";this.oMdlEditRecord.getData().EditRecord.MobileNo="";this.oMdlEditRecord.getData().EditRecord.ContactPerson="";this.oMdlEditRecord.getData().EditRecord.CntctRelation="";this.oMdlEditRecord.getData().EditRecord.AddressLine1="";this.oMdlEditRecord.getData().EditRecord.AddressLine2="";this.oMdlEditRecord.getData().EditRecord.City="";this.oMdlEditRecord.getData().EditRecord.Province="";this.oMdlEditRecord.getData().EditRecord.Country="";this.oMdlEditRecord.getData().EditRecord.PostalCode="";this.oMdlEditRecord.getData().EditRecord.CompanyWork="";this.oMdlEditRecord.getData().EditRecord.EmailWork="";this.oMdlEditRecord.getData().EditRecord.LandlineNoWork="";this.oMdlEditRecord.getData().EditRecord.MobileNoWork="";this.oMdlEditRecord.getData().EditRecord.AddressLine1Work="";this.oMdlEditRecord.getData().EditRecord.AddressLine2Work="";this.oMdlEditRecord.getData().EditRecord.CityWork="";this.oMdlEditRecord.getData().EditRecord.ProvinceWork="";this.oMdlEditRecord.getData().EditRecord.CountryWork="";this.oMdlEditRecord.getData().EditRecord.PostalCodeWork="";this.oMdlEditRecord.getData().EditRecord.WorkingYears=0;this.oMdlEditRecord.getData().EditRecord.PositionWork="";this.oMdlEditRecord.getData().EditRecord.ARAccount="";this.oMdlEditRecord.getData().EditRecord.MktGroup="";this.oMdlEditRecord.getData().EditRecord.MktClassification="";this.oMdlEditRecord.getData().EditRecord.MktCustomerSource="";this.oMdlEditRecord.getData().EditRecord.MktUserDefined1="";this.oMdlEditRecord.getData().EditRecord.MktUserDefined2="";this.oMdlEditRecord.getData().EditRecord.MktUserDefined3="";this.oMdlEditRecord.getData().EditRecord.MktUserDefined4="";this.oMdlEditRecord.getData().EditRecord.MktUserDefined5="";this.oMdlEditRecord.refresh();this.getView().byId("idIconTabBarInlineMode").getItems()[1].setText("RECORD [ADD]");var e=this.getView().byId("idIconTabBarInlineMode");e.setSelectedKey("tab2");this.bIsAdd=true},onSelectGender:function(t){var e=t.getSource().getProperty("text");this.oMdlEditRecord.getData().EditRecord.Gender=e.toUpperCase()},onSave:function(t){if(this.bIsAdd){var e=r.generateUDTCode();var o="";$.ajax({url:"/rexsjs/public/rexsjs/ExecQuery.xsjs?dbName=APP_RE&procName=SPAPP_RE_GENERATECUSTOMER&lastName="+this.oMdlEditRecord.getData().EditRecord.LastName,type:"GET",async:false,xhrFields:{withCredentials:true},error:function(t,e,d){jQuery.sap.log.error("This should never have happened!")},success:function(t){o=t[0].Code},context:this}).done(function(t){if(t){o=t[0].Code}});var i={};i.M_CUSTOMER=[];var a={};a.O="I";a.Code=e;a.CustomerCode=o;a.StatusCode=this.oMdlEditRecord.getData().EditRecord.StatusCode;a.FirstName=this.oMdlEditRecord.getData().EditRecord.FirstName;a.MiddleName=this.oMdlEditRecord.getData().EditRecord.MiddleName;a.LastName=this.oMdlEditRecord.getData().EditRecord.LastName;a.Title=this.oMdlEditRecord.getData().EditRecord.Title;a.AcadTitle=this.oMdlEditRecord.getData().EditRecord.AcadTitle;a.BirthDate=r.getDatePostingFormat(this.oMdlEditRecord.getData().EditRecord.BirthDate);a.BirthPlace=this.oMdlEditRecord.getData().EditRecord.BirthPlace;a.Gender=this.oMdlEditRecord.getData().EditRecord.Gender;a.Nationality=this.oMdlEditRecord.getData().EditRecord.Nationality;a.CivilStat=this.oMdlEditRecord.getData().EditRecord.CivilStat;a.SpouseName=this.oMdlEditRecord.getData().EditRecord.SpouseName;a.TIN=this.oMdlEditRecord.getData().EditRecord.TIN;a.Email=this.oMdlEditRecord.getData().EditRecord.Email;a.LandlineNo=this.oMdlEditRecord.getData().EditRecord.LandlineNo;a.MobileNo=this.oMdlEditRecord.getData().EditRecord.MobileNo;a.ContactPerson=this.oMdlEditRecord.getData().EditRecord.ContactPerson;a.CntctRelation=this.oMdlEditRecord.getData().EditRecord.CntctRelation;a.AddressLine1=this.oMdlEditRecord.getData().EditRecord.AddressLine1;a.AddressLine2=this.oMdlEditRecord.getData().EditRecord.AddressLine2;a.City=this.oMdlEditRecord.getData().EditRecord.City;a.Province=this.oMdlEditRecord.getData().EditRecord.Province;a.Country=this.oMdlEditRecord.getData().EditRecord.Country;a.PostalCode=this.oMdlEditRecord.getData().EditRecord.PostalCode;a.CompanyWork=this.oMdlEditRecord.getData().EditRecord.CompanyWork;a.EmailWork=this.oMdlEditRecord.getData().EditRecord.EmailWork;a.LandlineNoWork=this.oMdlEditRecord.getData().EditRecord.LandlineNoWork;a.MobileNoWork=this.oMdlEditRecord.getData().EditRecord.MobileNoWork;a.AddressLine1Work=this.oMdlEditRecord.getData().EditRecord.AddressLine1Work;a.AddressLine2Work=this.oMdlEditRecord.getData().EditRecord.AddressLine2Work;a.CityWork=this.oMdlEditRecord.getData().EditRecord.CityWork;a.ProvinceWork=this.oMdlEditRecord.getData().EditRecord.ProvinceWork;a.CountryWork=this.oMdlEditRecord.getData().EditRecord.CountryWork;a.PostalCodeWork=this.oMdlEditRecord.getData().EditRecord.PostalCodeWork;a.WorkingYears=this.oMdlEditRecord.getData().EditRecord.WorkingYears;a.PositionWork=this.oMdlEditRecord.getData().EditRecord.PositionWork;a.ARAccount=this.oMdlEditRecord.getData().EditRecord.ARAccount;a.MktGroup=this.oMdlEditRecord.getData().EditRecord.MktGroup;a.MktClassification=this.oMdlEditRecord.getData().EditRecord.MktClassification;a.MktCustomerSource=this.oMdlEditRecord.getData().EditRecord.MktCustomerSource;a.MktUserDefined1=this.oMdlEditRecord.getData().EditRecord.MktUserDefined1;a.MktUserDefined2=this.oMdlEditRecord.getData().EditRecord.MktUserDefined2;a.MktUserDefined3=this.oMdlEditRecord.getData().EditRecord.MktUserDefined3;a.MktUserDefined4=this.oMdlEditRecord.getData().EditRecord.MktUserDefined4;a.MktUserDefined5=this.oMdlEditRecord.getData().EditRecord.MktUserDefined5;i.M_CUSTOMER.push(a);var s=r.postData(i);if(s===0){d.show("Saved Successfully")}else{d.show("Error")}}else{i={};i.M_CUSTOMER=[];a={};a.O="U";a.Code=this.oMdlEditRecord.getData().EditRecord.Code;a.CustomerCode=this.oMdlEditRecord.getData().EditRecord.CustomerCode;a.StatusCode=this.oMdlEditRecord.getData().EditRecord.StatusCode;a.FirstName=this.oMdlEditRecord.getData().EditRecord.FirstName;a.MiddleName=this.oMdlEditRecord.getData().EditRecord.MiddleName;a.LastName=this.oMdlEditRecord.getData().EditRecord.LastName;a.BirthDate=r.getDatePostingFormat(this.oMdlEditRecord.getData().EditRecord.BirthDate);a.BirthPlace=this.oMdlEditRecord.getData().EditRecord.BirthPlace;a.Gender=this.oMdlEditRecord.getData().EditRecord.Gender;a.Nationality=this.oMdlEditRecord.getData().EditRecord.Nationality;a.CivilStat=this.oMdlEditRecord.getData().EditRecord.CivilStat;a.TIN=this.oMdlEditRecord.getData().EditRecord.TIN;a.Email=this.oMdlEditRecord.getData().EditRecord.Email;a.LandlineNo=this.oMdlEditRecord.getData().EditRecord.LandlineNo;a.MobileNo=this.oMdlEditRecord.getData().EditRecord.MobileNo;a.ContactPerson=this.oMdlEditRecord.getData().EditRecord.ContactPerson;a.CntctRelation=this.oMdlEditRecord.getData().EditRecord.CntctRelation;a.WorkNatureBusiness=this.oMdlEditRecord.getData().EditRecord.WorkNatureBusiness;a.FundSource=this.oMdlEditRecord.getData().EditRecord.FundSource;a.WorkingYears=this.oMdlEditRecord.getData().EditRecord.WorkingYears;a.Referral=this.oMdlEditRecord.getData().EditRecord.Referral;a.CustomerCode=this.oMdlEditRecord.getData().EditRecord.CustomerCode;a.FirstName=this.oMdlEditRecord.getData().EditRecord.FirstName;a.MiddleName=this.oMdlEditRecord.getData().EditRecord.MiddleName;a.LastName=this.oMdlEditRecord.getData().EditRecord.LastName;a.Title=this.oMdlEditRecord.getData().EditRecord.Title;a.AcadTitle=this.oMdlEditRecord.getData().EditRecord.AcadTitle;a.BirthDate=this.oMdlEditRecord.getData().EditRecord.BirthDate;a.BirthPlace=this.oMdlEditRecord.getData().EditRecord.BirthPlace;a.Gender=this.oMdlEditRecord.getData().EditRecord.Gender;a.Nationality=this.oMdlEditRecord.getData().EditRecord.Nationality;a.CivilStat=this.oMdlEditRecord.getData().EditRecord.CivilStat;a.SpouseName=this.oMdlEditRecord.getData().EditRecord.SpouseName;a.TIN=this.oMdlEditRecord.getData().EditRecord.TIN;a.Email=this.oMdlEditRecord.getData().EditRecord.Email;a.LandlineNo=this.oMdlEditRecord.getData().EditRecord.LandlineNo;a.MobileNo=this.oMdlEditRecord.getData().EditRecord.MobileNo;a.ContactPerson=this.oMdlEditRecord.getData().EditRecord.ContactPerson;a.CntctRelation=this.oMdlEditRecord.getData().EditRecord.CntctRelation;a.AddressLine1=this.oMdlEditRecord.getData().EditRecord.AddressLine1;a.AddressLine2=this.oMdlEditRecord.getData().EditRecord.AddressLine2;a.City=this.oMdlEditRecord.getData().EditRecord.City;a.Province=this.oMdlEditRecord.getData().EditRecord.Province;a.Country=this.oMdlEditRecord.getData().EditRecord.Country;a.PostalCode=this.oMdlEditRecord.getData().EditRecord.PostalCode;a.CompanyWork=this.oMdlEditRecord.getData().EditRecord.CompanyWork;a.EmailWork=this.oMdlEditRecord.getData().EditRecord.EmailWork;a.LandlineNoWork=this.oMdlEditRecord.getData().EditRecord.LandlineNoWork;a.MobileNoWork=this.oMdlEditRecord.getData().EditRecord.MobileNoWork;a.AddressLine1Work=this.oMdlEditRecord.getData().EditRecord.AddressLine1Work;a.AddressLine2Work=this.oMdlEditRecord.getData().EditRecord.AddressLine2Work;a.CityWork=this.oMdlEditRecord.getData().EditRecord.CityWork;a.ProvinceWork=this.oMdlEditRecord.getData().EditRecord.ProvinceWork;a.CountryWork=this.oMdlEditRecord.getData().EditRecord.CountryWork;a.PostalCodeWork=this.oMdlEditRecord.getData().EditRecord.PostalCodeWork;a.WorkingYears=this.oMdlEditRecord.getData().EditRecord.WorkingYears;a.PositionWork=this.oMdlEditRecord.getData().EditRecord.PositionWork;a.ARAccount=this.oMdlEditRecord.getData().EditRecord.ARAccount;a.MktGroup=this.oMdlEditRecord.getData().EditRecord.MktGroup;a.MktClassification=this.oMdlEditRecord.getData().EditRecord.MktClassification;a.MktCustomerSource=this.oMdlEditRecord.getData().EditRecord.MktCustomerSource;a.MktUserDefined1=this.oMdlEditRecord.getData().EditRecord.MktUserDefined1;a.MktUserDefined2=this.oMdlEditRecord.getData().EditRecord.MktUserDefined2;a.MktUserDefined3=this.oMdlEditRecord.getData().EditRecord.MktUserDefined3;a.MktUserDefined4=this.oMdlEditRecord.getData().EditRecord.MktUserDefined4;a.MktUserDefined5=this.oMdlEditRecord.getData().EditRecord.MktUserDefined5;i.M_CUSTOMER.push(a);s=r.postData(i);if(s===0){d.show("Successfully Updated "+this.oMdlEditRecord.getData().EditRecord.Code)}else{d.show("Error")}}this.prepareTable(false)},filterGlobally:function(t){var e=t.getParameter("query");this._oGlobalFilter=null;if(e){this._oGlobalFilter=new o([new o("Name",i.Contains,e),new o("CustomerCode",i.Contains,e)],false)}this._filter()},_filter:function(){var t=null;if(this._oGlobalFilter){t=this._oGlobalFilter}this.byId("tblBP").getBinding().filter(t,"Application")},clearAllFilters:function(t){var e=this.getView().byId("tblBP");this._oGlobalFilter=null;this._filter();var d=e.getColumns();for(var o=0;o<d.length;o++){e.filter(d[o],null)}}})});